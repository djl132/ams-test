<!doctype html>
<script src="code/promise.js"></script>

<div id="grid"></div>
<button id="next">Next generation</button>
<button id="run">Auto run</button>

<script>
    var width = 30, height = 15;

    // I will represent the grid as an array of booleans.

    //create checkbox array
    //display checkboxes
var gridNode = document.querySelector("#grid")
    // This holds the checkboxes that display the grid in the document.
    var checkboxes = [];

    //set up check boxes.
    for (var y = 0; y < height; y++) {
        for (var x = 0; x < width; x++) {
            var box = document.createElement("input");
            box.type = "checkbox";
            gridNode.appendChild(box);

            //store a reference to node for changing the boxes' states later
            checkboxes.push(box);
        }

        //go to new line for each row
        gridNode.appendChild(document.createElement("br"));
    }

//get array of boolean for checked or nonchecked.
    function gridFromCheckboxes() {
        return checkboxes.map(function(box) {
            return box.checked; });
    }

    //create a boolean construct that represents the checked and unchecked boxes.
    function randomGrid(){
        var result = [];
        for (var x = 0; y < height * width; y++)
            result.push(Math.random() < 0.3);
        return result;
    }

//use the checkbox references to change the state of the boxes.
    function checkboxesFromGrid(grid){
        grid.forEach(function(value, i){
            checkboxes[i].checked = value;
        });
    }

    //GENERATE RANDOM GRID OF CHECKBOXES.
    checkboxesFromGrid(randomGrid());

    // This does a two-dimensional loop over the square around the given
    // x,y position, counting all fields that have a cell but are not the
    // center field.
    function countNeighbors(grid, x, y) {
        var count = 0;

        //howis this neighbot? HOW IS THIS COUNTING DONE?????
        for (var y1 = Math.max(0, y - 1); y1 <= Math.min(height - 1, y + 1); y1++) {
            for (var x1 = Math.max(0, x - 1); x1 <= Math.min(width - 1, x + 1); x1++) {


                if ((x1 != x || y1 != y) && grid[x1 + y1 * width])
                    count += 1;
            }
        }
        return count;
    }

    //create next generation's grid
    function nextGeneration(grid) {
        var newGrid = new Array(width * height);
        for (var y = 0; y < height; y++) {
            for (var x = 0; x < width; x++) {
                var neighbors = countNeighbors(grid, x, y);
                var offset = x + y * width;
                if (neighbors < 2 || neighbors > 3)
                    newGrid[offset] = false;
                else if (neighbors == 2)
                    newGrid[offset] = grid[offset];
                else
                    //handles both case of 3 neighbors being next it it.
                    newGrid[offset] = true;
            }
        }
        return newGrid;
    }

    //go to the next generation
    function turn() {
        checkboxesFromGrid(nextGeneration(gridFromCheckboxes()));
    }

    document.querySelector("#next").addEventListener("click", turn);

    var running = null;
    document.querySelector("#run").addEventListener("click", function() {
        if (running) {
            clearInterval(running);
            running = null;
        } else {
            running = setInterval(turn, 400);
        }
    });

</script>

